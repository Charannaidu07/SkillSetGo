<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointments | SkillSetGo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --secondary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --accent-color: #4e73df;
            --text-dark: #2d3748;
            --text-light: #f8f9fa;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --transition-base: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Inter', sans-serif;
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navbar Styles - Same as before */
        .navbar {
            background: var(--primary-gradient);
            box-shadow: var(--shadow-lg);
            padding: 0.8rem 2rem;
            transition: var(--transition-base);
            position: relative;
            z-index: 1000;
        }

        /* Main Content Styles */
        .main-container {
            flex: 1;
            padding: 2rem 0;
            background-color: #f8f9fa;
        }

        /* Appointments Grid */
        .appointments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 768px) {
            .appointments-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Appointment Card */
        .appointment-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            padding: 1.5rem;
            transition: var(--transition-base);
            border-left: 4px solid var(--accent-color);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .appointment-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .appointment-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin: 0;
            color: var(--text-dark);
        }

        .appointment-status {
            font-weight: 600;
            padding: 0.35rem 0.75rem;
            border-radius: 8px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .appointment-details {
            flex-grow: 1;
            margin-bottom: 1.5rem;
        }

        .appointment-detail {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .appointment-detail i {
            width: 20px;
            margin-right: 0.75rem;
            color: var(--accent-color);
        }

        .appointment-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .appointment-price {
            font-weight: 600;
            color: var(--accent-color);
        }

        /* Status Badges */
        .status-pending {
            background-color: #ffc107;
            color: #000;
        }

        .status-completed {
            background-color: #28a745;
            color: #fff;
        }

        .status-cancelled {
            background-color: #dc3545;
            color: #fff;
        }

        /* Empty State */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }
        /* Modal Styles */
        .appointment-modal .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: var(--shadow-lg);
        }
        
        .appointment-modal .modal-header {
            background: var(--primary-gradient);
            color: white;
            border-radius: 12px 12px 0 0;
            border-bottom: none;
        }
        
        .appointment-modal .modal-body {
            padding: 2rem;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 1rem;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--text-dark);
            min-width: 150px;
        }
        
        .detail-value {
            flex: 1;
        }
        
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .image-thumbnail {
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition-base);
        }
        
        .image-thumbnail:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        .no-images {
            color: #6c757d;
            font-style: italic;
        }
        .image-gallery {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 20px;
}

.image-thumbnail {
    width: 100%;
    height: auto;
    border-radius: 8px;
    object-fit: cover;
    aspect-ratio: 1 / 1; /* This makes images square */
}
.image-gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-bottom: 20px;
}

.image-gallery .gallery-item {
    flex: 1 1 calc(50% - 16px); /* 2 items per row with gap */
    min-width: 0;
}

.image-thumbnail {
    width: 100%;
    height: auto;
    border-radius: 8px;
    object-fit: cover;
    aspect-ratio: 1 / 1;
}

        /* Rest of your existing styles... */
    </style>
    <style>
        .bargaining-history {
            border-top: 1px solid #eee;
            padding-top: 1rem;
            margin-top: 1.5rem;
        }
        .bargain-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--accent-color);
        }
        .bargain-price {
            font-weight: 600;
        }
        .bargain-message {
            color: #6c757d;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .bargain-meta {
            font-size: 0.75rem;
            color: #adb5bd;
            margin-top: 0.5rem;
        }
        .bargain-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }
        .status-pending {
            background-color: #ffc107;
            color: #000;
        }
        .status-accepted {
            background-color: #28a745;
            color: #fff;
        }
        .status-rejected {
            background-color: #dc3545;
            color: #fff;
        }
        .status-counter {
            background-color: #17a2b8;
            color: #fff;
        }
        .price-comparison {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Navbar (same as before) -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url 'index' %}">SkillSetGo</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarMain">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'service' %}">Services</a>
                    </li>
                    {% if user.user_type == 'servicer' %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'service_provider_dashboard' %}">Dashboard</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'book_appointment' %}">Book Appointment</a>
                    </li>
                    {% endif %}
                </ul>
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> {{ user.first_name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="fas fa-user me-2"></i> Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-shopping-cart me-2"></i> Cart</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'account_login' %}"><i class="fas fa-sign-in-alt me-1"></i> Login</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    {% if provider.is_verified %}
                    <h4 class="section-title"><i class="fas fa-calendar-check me-2"></i> Your Appointments</h4>
                    
                    <div class="appointments-grid">
                        {% if appointments %}
                            {% for appointment in appointments %}
                            <div class="appointment-card animate__animated animate__fadeInUp">
                                <div class="appointment-header">
                                    <h5 class="appointment-title">
                                        {% if appointment.issue == 'others' %}
                                            {{ appointment.custom_issue }}
                                        {% else %}
                                            {{ appointment.get_issue_display }}
                                        {% endif %}
                                    </h5>
                                    <span class="appointment-status 
                                        {% if appointment.status == 'completed' %}status-completed
                                        {% elif appointment.status == 'pending' %}status-pending
                                        {% else %}status-cancelled{% endif %}">
                                        {{ appointment.get_status_display }}
                                    </span>
                                </div>
                                
                                <div class="appointment-details">
                                    <div class="appointment-detail">
                                        <i class="fas fa-user"></i>
                                        <span>{{ appointment.customer_name }}</span>
                                    </div>
                                    <div class="appointment-detail">
                                        <i class="fas fa-clock"></i>
                                        <span>{{ appointment.appointment_date|date:"F j, Y" }} at {{ appointment.appointment_time|time:"g:i A" }}</span>
                                    </div>
                                    <div class="appointment-detail">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>{{ appointment.address|truncatechars:40 }}</span>
                                    </div>
                                </div>
                                
                                <div class="appointment-footer">
                                    <div class="appointment-price">
                                        <i class="fas fa-rupee-sign"></i> {{ appointment.expected_amount }}
                                    </div>
                                    <div class="appointment-footer">
            <div>
                <button class="btn btn-sm btn-outline-primary me-2" 
                        data-bs-toggle="modal" 
                        data-bs-target="#appointmentModal"
                        onclick="loadAppointmentDetails({{ appointment.id }})">
                    Details
                </button>
                {% if appointment.status == 'pending' %}
                    <a href="#" class="btn btn-sm btn-success">Accept</a>
                {% endif %}
            </div>
        </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <i class="far fa-calendar-times fa-3x mb-3 text-muted"></i>
                                <h5>No Appointments Found</h5>
                                <p class="text-muted mb-4">You don't have any appointments scheduled yet.</p>
                                {% if user.user_type == 'servicer' %}
                                <a href="{% url 'service_provider_dashboard' %}" class="btn btn-primary">Go to Dashboard</a>
                                {% else %}
                                <a href="{% url 'book_appointment' %}" class="btn btn-primary">Book New Appointment</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i> Account Not Verified</h5>
                        <p>Your service provider account is not yet verified. Please complete your profile and verification process to access appointments.</p>
                        <hr>
                        <a href="{% url 'service_provider_dashboard' %}" class="btn btn-sm btn-warning">Complete Verification</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>
    <!-- Add this modal at the bottom of your body, before scripts -->
    <div class="modal fade appointment-modal" id="appointmentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Appointment Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="detail-row">
                        <div class="detail-label">Service Type:</div>
                        <div class="detail-value" id="detail-issue"></div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">Customer Name:</div>
                        <div class="detail-value" id="detail-customer"></div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">Contact Number:</div>
                        <div class="detail-value" id="detail-contact"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Booking Id:</div>
                        <div class="detail-value" id="detail-booking"></div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">Scheduled Time:</div>
                        <div class="detail-value" id="detail-time"></div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">Expected Budget:</div>
                        <div class="detail-value" id="detail-amount"></div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">Description:</div>
                        <div class="detail-value" id="detail-description"></div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">Location:</div>
                        <div class="detail-value" id="detail-location"></div>
                    </div>
                    
                    <h6 class="mt-4 mb-3">Images:</h6>
                    <div class="image-gallery" id="detail-images">
                        <!-- Images will be inserted here by JavaScript -->
                    </div>
                    
                    <div class="bargaining-history">
                        <h6 class="mb-3">Price Negotiation History</h6>
                        <div id="bargainHistory">
                            <!-- History will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bargainModal" 
                            id="bargainButton" style="display: none;">
                        Bargain Price
                    </button>
                    <button class="btn btn-success" id="acceptButton" style="display: none;">
                        Accept Appointment
                    </button>
                </div>
            </div>
        </div>
    </div>
   <div class="modal fade" id="bargainModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Negotiate Price</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Initial Price:</label>
                        <input type="text" class="form-control" id="initialPrice" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Your Offer:</label>
                        <input type="number" class="form-control" id="offerPrice" placeholder="Enter your offer price">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Message (Optional):</label>
                        <textarea class="form-control" id="offerMessage" rows="3" placeholder="Add any notes..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitBargain()">Submit Offer</button>
                </div>
            </div>
        </div>
    </div>

    {% include 'footer.html' %}

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Animation for cards when they come into view
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.appointment-card').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
    <script>
        // Function to load appointment details via AJAX
        function loadAppointmentDetails(appointmentId) {
            // Clear previous content
            document.getElementById('detail-images').innerHTML = '';
            
            // Fetch appointment details
            fetch(`/api/appointments/${appointmentId}/`)
                .then(response => response.json())
                .then(data => {
                    // Populate modal with data
                    document.getElementById('detail-issue').textContent = 
                        data.issue === 'others' ? data.custom_issue : data.issue_display;
                    document.getElementById('detail-customer').textContent = data.full_name;
                    document.getElementById('detail-booking').textContent = data.booking_id;
                    document.getElementById('detail-contact').textContent = data.contact_number;
                    document.getElementById('detail-time').textContent = 
                        new Date(data.expected_time).toLocaleString();
                    document.getElementById('detail-amount').textContent = 
                        '₹' + data.expected_amount;
                    document.getElementById('detail-description').textContent = data.description;
                    document.getElementById('detail-location').textContent = 
                        `${data.address}, ${data.city}, ${data.state} - ${data.pincode}, ${data.country}`;
                    
                    // Handle images
                    const imageGallery = document.getElementById('detail-images');
const images = [data.image1, data.image2, data.image3, data.image4]
    .filter(img => img !== null && img.trim() !== '');

if (images.length > 0) {
    images.forEach(imgUrl => {
        const imgContainer = document.createElement('div');
        imgContainer.className = 'gallery-item';
        
        const img = document.createElement('img');
        img.src = imgUrl;
        img.className = 'image-thumbnail';
        img.alt = 'Appointment image';
        img.loading = 'lazy'; // for lazy loading
        
        imgContainer.appendChild(img);
        imageGallery.appendChild(imgContainer);
    });
} else {
                        const noImages = document.createElement('p');
                        noImages.className = 'no-images';
                        noImages.textContent = 'No images provided';
                        imageGallery.appendChild(noImages);
                    }
                })
                .catch(error => {
                    console.error('Error fetching appointment details:', error);
                    alert('Failed to load appointment details');
                });
        }
    </script>
    <script>
        // Add these new functions to your existing script
        let currentAppointmentId = null;
        let initialPrice = 0;

        function prepareBargain(appointmentId, price) {
            currentAppointmentId = appointmentId;
            initialPrice = price;
            document.getElementById('initialPrice').value = '₹' + price;
            document.getElementById('offerPrice').value = '';
            document.getElementById('offerMessage').value = '';
        }

        function submitBargain() {
            const offerPrice = document.getElementById('offerPrice').value;
            const offerMessage = document.getElementById('offerMessage').value;
            
            if (!offerPrice || isNaN(offerPrice)) {
                alert('Please enter a valid price');
                return;
            }

            fetch('/api/bargain/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    appointment_id: currentAppointmentId,
                    servicer_offer: offerPrice,
                    message: offerMessage
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Your offer has been submitted!');
                    $('#bargainModal').modal('hide');
                    loadAppointmentDetails(currentAppointmentId);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to submit offer');
            });
        }

        function acceptAppointment() {
            if (confirm('Are you sure you want to accept this appointment at the requested price?')) {
                fetch(`/api/appointments/${currentAppointmentId}/accept/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Appointment accepted successfully!');
                        $('#appointmentModal').modal('hide');
                        location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to accept appointment');
                });
            }
        }

        // Update your loadAppointmentDetails function
        function loadAppointmentDetails(appointmentId) {
            currentAppointmentId = appointmentId;
            
            // Clear previous content
            document.getElementById('detail-images').innerHTML = '';
            document.getElementById('bargainHistory').innerHTML = '';
            
            // Fetch appointment details
            fetch(`/api/appointments/${appointmentId}/`)
                .then(response => response.json())
                .then(data => {
                    // Populate modal with data
                    document.getElementById('detail-issue').textContent = 
                        data.issue === 'others' ? data.custom_issue : data.issue_display;
                    document.getElementById('detail-customer').textContent = data.full_name;
                    document.getElementById('detail-contact').textContent = data.contact_number;
                    document.getElementById('detail-booking').textContent = data.booking_id;
                    document.getElementById('detail-time').textContent = 
                        new Date(data.expected_time).toLocaleString();
                    document.getElementById('detail-amount').textContent = 
                        '₹' + data.expected_amount;
                    document.getElementById('detail-description').textContent = data.description;
                    document.getElementById('detail-location').textContent = 
                        `${data.address}, ${data.city}, ${data.state} - ${data.pincode}, ${data.country}`;
                    
                    // Handle images
                    const imageGallery = document.getElementById('detail-images');
                    const images = [data.image1, data.image2, data.image3, data.image4]
                        .filter(img => img !== null && img.trim() !== '');

                    if (images.length > 0) {
                        images.forEach(imgUrl => {
                            const imgContainer = document.createElement('div');
                            imgContainer.className = 'gallery-item';
                            
                            const img = document.createElement('img');
                            img.src = imgUrl;
                            img.className = 'image-thumbnail';
                            img.alt = 'Appointment image';
                            img.loading = 'lazy';
                            
                            imgContainer.appendChild(img);
                            imageGallery.appendChild(imgContainer);
                        });
                    } else {
                        const noImages = document.createElement('p');
                        noImages.className = 'no-images';
                        noImages.textContent = 'No images provided';
                        imageGallery.appendChild(noImages);
                    }
                    
                    // Handle bargaining history
                    if (data.bargaining_history && data.bargaining_history.length > 0) {
                        const historyContainer = document.getElementById('bargainHistory');
                        data.bargaining_history.forEach(item => {
                            const historyItem = document.createElement('div');
                            historyItem.className = 'bargain-item';
                            
                            const statusClass = `status-${item.status}`;
                            
                            historyItem.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="price-comparison">
                                        <span class="bargain-price">₹${item.initial_price}</span>
                                        <i class="fas fa-arrow-right"></i>
                                        <span class="bargain-price">₹${item.offer_price}</span>
                                    </div>
                                    <span class="bargain-status ${statusClass}">
                                        ${item.status_display}
                                    </span>
                                </div>
                                ${item.message ? `<div class="bargain-message">${item.message}</div>` : ''}
                                <div class="bargain-meta">
                                    Offered by ${item.offered_by === 'servicer' ? 'You' : 'Customer'} on ${new Date(item.created_at).toLocaleString()}
                                </div>
                            `;
                            historyContainer.appendChild(historyItem);
                        });
                    } else {
                        document.getElementById('bargainHistory').innerHTML = 
                            '<p class="text-muted">No negotiation history yet</p>';
                    }
                    
                    // Show/hide buttons based on status
                    const bargainBtn = document.getElementById('bargainButton');
                    const acceptBtn = document.getElementById('acceptButton');
                    
                    if (data.status === 'pending') {
                        bargainBtn.style.display = 'inline-block';
                        acceptBtn.style.display = 'inline-block';
                        
                        // Set up button click handlers
                        bargainBtn.onclick = function() {
                            prepareBargain(appointmentId, data.expected_amount);
                        };
                        
                        acceptBtn.onclick = acceptAppointment;
                    } else {
                        bargainBtn.style.display = 'none';
                        acceptBtn.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error fetching appointment details:', error);
                    alert('Failed to load appointment details');
                });
        }
    </script>
</body>
</html>